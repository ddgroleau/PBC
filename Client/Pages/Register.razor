@page "/register"
@inject IAccountRegisterDTO Model
@inject ILazor Lazor
@inject HttpClient Http

<div class="card">
    <h4 class="card-header">Register</h4>
    <div class="card-body">
        <EditForm Model="@Model">
            <DataAnnotationsValidator />
            <div class="form-group">
                <label>Email</label>
                <InputText @bind-Value="Model.Email" class="form-control" />
                <ValidationMessage For="@(() => Model.Email)" />
            </div>
            <div class="form-group">
                <label>Password</label>
                <InputText @bind-Value="Model.Password" type="password" class="form-control" />
                <ValidationMessage For="@(() => Model.Password)" />
            </div>
            <div class="form-group">
                <label>Password</label>
                <InputText @bind-Value="Model.ConfirmPassword" type="password" class="form-control" />
                <ValidationMessage For="@(() => Model.ConfirmPassword)" />
            </div>

                <LoadingButton HandleClick="async ()=> await HandleRegister()" Loading="@Lazor.Loading">Register</LoadingButton>
                <span class="small form-text text-danger">@Lazor.ErrorMessage</span>
            <NavLink href="login" class="btn btn-link">Login</NavLink>
        </EditForm>
    </div>
</div>


@code {
 public async Task<bool> HandleRegister()
    {
        try
        {
        var response = await Http.PostAsJsonAsync("/api/Account/Register", Model);
        bool isRegistered = response.IsSuccessStatusCode;

            if(!isRegistered)
            {
                Lazor.SetErrorMessage("Registration failed. Try again.");
            }

        return isRegistered;
        }
        catch
        {
            Lazor.SetErrorMessage("An error occurred. Try again.");
            return false;
        }
    }
}